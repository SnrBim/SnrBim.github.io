# Gemini Agent Instructions for SnrBim.github.io

This file provides context and instructions for the Gemini AI agent.

## Project Overview

*   **Project Name:** SnrBim.github.io
*   **Description:** The documentation website for the Sener BIMTools project, built with Jekyll and hosted on GitHub Pages.
*   **Live URL:** https://snrbim.github.io/
*   **Source Repository (for this site):** https://github.com/SnrBim/SnrBim.github.io
*   **Source Repository (for BIMTools):** https://github.com/SnrBim/BIMTools

## Key Technologies

*   **Static Site Generator:** Jekyll
*   **Theme:** just-the-docs
*   **Language:** Ruby (Portable version)

## Local Development Workflow

To run the documentation site locally for previewing changes, follow these steps precisely.

**Prerequisites:** A portable version of Ruby with DevKit is located at `C:\Users\1M06174\ruby\rubyinstaller-3.4.7-1-x64`.

**Steps to run the local server:**

1.  Open a new PowerShell terminal.
2.  Navigate to the website's project directory:
    ```powershell
    cd C:\Users\1M06174\source\repos\BIMTools\publish\SnrBim.github.io\
    ```
3.  **Synchronize documentation:** Run the publishing script to copy the latest documentation from the main `BIMTools` repository.
    ```powershell
    .\Publish-Docs.ps1
    ```
4.  **Activate the Ruby environment.** This step is crucial because the Ruby installation is portable.
    ```powershell
    $env:PATH = "C:\Users\1M06174\ruby\rubyinstaller-3.4.7-1-x64\bin;" + $env:PATH
    ```
5.  Run the Jekyll server:
    ```powershell
    bundle exec jekyll serve
    ```
6.  The site will be available at **http://127.0.0.1:4000/**. The server will auto-regenerate when you save changes to any source files *within this project*, but you must re-run `Publish-Docs.ps1` to see changes from the source repository.

## Documentation Publishing Workflow (`Publish-Docs.ps1`)

The content for the documentation is not stored in this repository directly. It is aggregated from the main `BIMTools` repository using the `Publish-Docs.ps1` script.

### Source Structure Convention

For the script to work, each command's documentation in the `BIMTools` repository **must** follow this structure:

*   The source folder is named in `PascalCase` (e.g., `AssignConduitToCircuit`).
*   Inside this folder, there must be a `Docs` subdirectory.
*   The `Docs` subdirectory contains:
    *   `front-matter.yaml`: A YAML file containing at least the `title`.
    *   `En.md`: The English content for the page.
    *   `Es.md`: The Spanish content for the page.
    *   Any assets (like `pic1.png`) used by the documentation.

Example:
```
BIMTools\
└── AssignConduitToCircuit\
    └── Docs\
        ├── En.md
        ├── Es.md
        ├── front-matter.yaml
        └── pic1.png
```

### Script Automation Logic

When you run `.\Publish-Docs.ps1`, it performs the following for each command found:

1.  **Reads `title`:** It opens `front-matter.yaml` and reads the `title`.
2.  **Generates a "slug":** It converts the title into a URL-friendly `kebab-case` string.
    *   `title: Assign Circuit To Conduits` -> `assign-circuit-to-conduits`
3.  **Checks for Duplicates:** The script will stop with an error if it finds multiple commands with the same `title`, as this would cause them to overwrite each other.
4.  **Generates Template Page (`index.md`):** It creates a new `index.md` file in `docs/<slug>/`. This file contains:
    *   The original front-matter from `front-matter.yaml` (excluding any `layout`, `namespace`, or `permalink` fields).
    *   A hardcoded `layout: default`.
    *   A generated `namespace` and `permalink`.
    *   A `{% translate_file docs/<slug>.md %}` tag after the front-matter, which tells Jekyll to load the content from the language-specific files.
5.  **Injects TOC and Copies Content:** It reads the content of `En.md` and `Es.md`, injects a language-specific Table of Contents after the main title, and copies the modified content to the `_i18n/<lang>/docs/` folder, renaming it to `<slug>.md`.
6.  **Copies Assets:** It copies all other files (like `pic1.png`) into the `docs/<slug>/` directory, alongside `index.md`.
7.  **Warns on Missing Translations:** It will show a warning if either `En.md` or `Es.md` is missing.

## Deployment Workflow

1.  **Update Content:** Before committing, ensure the latest documentation is pulled into the project by running the publishing script from the project root:
    ```powershell
    .\Publish-Docs.ps1
    ```
2.  **Commit and Push:** Commit the changes (which will include all the files generated by the script) and push them to the `main` branch.
3.  **Automatic Deployment:** Any changes pushed to the `main` branch will be automatically deployed to the live site by GitHub Pages.

## Multilingual Setup (jekyll-multiple-languages-plugin)

This project uses the `kurtsson/jekyll-multiple-languages-plugin` to manage content in multiple languages (en, es). The `Publish-Docs.ps1` script automates the creation of the necessary file structure for this plugin to work.

### Key Concepts:

*   **Language Files:** All translations for UI strings are stored in `.yml` files inside the `_i18n/` directory (e.g., `_i18n/en.yml`, `_i18n/es.yml`).
*   **Page Content:** The script places language-specific content into `_i18n/<lang>/docs/<slug>.md`.
*   **Template Pages:** The script generates template pages at `docs/<slug>/index.md`. These contain the front-matter needed to link the different language versions and a `{% translate_file %}` tag to include the actual content.
*   **Language Switcher:** The language switcher links are configured in `_config.yml` under `aux_links`. The switching logic is handled by the `initLangSwither` JavaScript function in `_includes/footer_custom.html`.

---

### Important Note on `default_locale_in_subfolder`

The configuration `default_locale_in_subfolder: true` **must not be used** in the current setup.

**Reason:**
This setting triggers a specific code path in the `jekyll-multiple-languages-plugin` (version 1.8.0) that handles the creation of a subfolder for the default language. This part of the plugin's code contains a call to `Dir.exists?`, a method that has been removed in modern versions of Ruby (the project uses Ruby 3.4.7).

Using this setting will cause the Jekyll build to fail with a `NoMethodError: undefined method 'exists?' for class Dir`.

To resolve this, one would need to either:
1.  Patch the plugin's code and set up a GitHub Actions workflow to build the site outside of GitHub Pages' `safe` mode.
2.  Migrate to a modern, maintained multilingual plugin like `jekyll-polyglot`.

Until then, the default language (`en`) will be served from the root of the website, and other languages will be in subfolders.

## Key Files

*   **`index.md`**: The main page of the site. It contains the Liquid logic to iterate through all commands and display them in a filterable list. It also includes the HTML structure, custom CSS, and JavaScript for the collapsible descriptions, their styling, animation, filtering, and the click handling logic that distinguishes between navigation and expansion.
*   **`Publish-Docs.ps1`**: A crucial PowerShell script that aggregates all documentation from the source `BIMTools` repository. It reads the `front-matter.yaml` for each command to get the title. It now also automatically extracts the first paragraph from `En.md` and `Es.md` and injects it as a `description` and `description_es` field into the front matter of the generated `index.md` for each command page.
*   **`_includes/footer_custom.html`**: A file intended for custom scripts and styles that apply globally across the site. It contains the JavaScript for the language switcher and theme toggling.

---
**Work Log:** PLAN.md